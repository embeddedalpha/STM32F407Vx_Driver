/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2023 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include "main.h"
#include "CAN.h"
#include "GPIO.h"


CAN_Config_t can_config;
CAN_Filter_TypeDef Slave1_Filter, Slave2_Filter, Slave3_Filter;
CAN_Packet Slave1_Payload;




int main(void)
{
	MCU_Clock_Setup();

	can_config.instance = CAN1;
	can_config.TX_Pins = CAN1_TX_Pin.PA12;
	can_config.RX_Pins = CAN1_RX_Pin.PA11;
	can_config.interrupt.Interrup_Enable = DISABLE;
	can_config.baudrate = CAN_Baudrate.baud_1000K;
	can_config.automoatic_retransmission = DISABLE;
	can_config.automatic_wakeup = DISABLE;
	can_config.ID_Type = CAN_ID_Type.Standard_ID;

	Slave1_Filter.active = 1;
	Slave1_Filter.number = 0;
	Slave1_Filter.Filter_mode = CAN_Filter_Mode.List;
	Slave1_Filter.FIFO_number = CAN_Fifo_Number.FIFO_0;
	Slave1_Filter.Bank1 = 0x001;

	Slave2_Filter.active = 1;
	Slave2_Filter.number = 1;
	Slave2_Filter.Filter_mode = CAN_Filter_Mode.List;
	Slave2_Filter.FIFO_number = CAN_Fifo_Number.FIFO_0;
	Slave2_Filter.Bank1 = 0x002;

	Slave3_Filter.active = 1;
	Slave3_Filter.number = 2;
	Slave3_Filter.Filter_mode = CAN_Filter_Mode.List;
	Slave3_Filter.FIFO_number = CAN_Fifo_Number.FIFO_0;
	Slave3_Filter.Bank1 = 0x003;

	CAN_PIN_Enable(&can_config);
	CAN_Setup(&can_config);
	CAN_Filter_Setup(&can_config, &Slave1_Filter);
	CAN_Filter_Setup(&can_config, &Slave2_Filter);
	CAN_Filter_Setup(&can_config, &Slave3_Filter);
	CAN_Normal_Mode(&can_config);

	Slave1_Payload.ID = 0x001;
	Slave1_Payload.data[0] = 0x00;
	Slave1_Payload.data[1] = 0x01;
	Slave1_Payload.data[2] = 0x02;
	Slave1_Payload.data[3] = 0x03;
	Slave1_Payload.data[4] = 0x04;
	Slave1_Payload.data[5] = 0x05;
	Slave1_Payload.data[6] = 0x06;
	Slave1_Payload.data[7] = 0x07;
	Slave1_Payload.data_length = 8;
	Slave1_Payload.frame_type = CAN_ID_Type.Standard_ID;
	Slave1_Payload.mailbox_number = 0;

	CAN_Send_Packet(&can_config, &Slave1_Payload);





    /* Loop forever */
	for(;;);
}
